<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurion Finance - Professional USDT Investment Platform</title>
    <link rel="icon" type="image/png" href="https://files.catbox.moe/3o41t1.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset & Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f172a; color: #e2e8f0; line-height: 1.6; }
        
        /* Preloader */
        .preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0f172a; display: flex; justify-content: center; align-items: center; z-index: 9999; }
        .loader { display: flex; gap: 8px; }
        .gold-bar { width: 12px; height: 40px; background: linear-gradient(45deg, #f59e0b, #fbbf24); animation: loader 1.2s infinite ease-in-out; }
        .gold-bar:nth-child(1) { animation-delay: -0.32s; }
        .gold-bar:nth-child(2) { animation-delay: -0.16s; }
        @keyframes loader { 0%, 80%, 100% { transform: scaleY(0.6); } 40% { transform: scaleY(1); } }
        .preloader.fade-out { opacity: 0; transition: opacity 0.5s ease; }
        
        /* Header & Navigation */
        .header { position: fixed; top: 0; width: 100%; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid #1e293b; }
        .nav { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; }
        .nav__logo { display: flex; align-items: center; gap: 12px; }
        .logo { width: 40px; height: 40px; }
        .logo__text { font-size: 1.5rem; font-weight: 700; background: linear-gradient(45deg, #f59e0b, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav__menu { display: flex; align-items: center; gap: 2rem; }
        .nav__list { display: flex; list-style: none; gap: 2rem; }
        .nav__link { color: #cbd5e1; text-decoration: none; font-weight: 500; transition: color 0.3s; padding: 0.5rem 1rem; border-radius: 8px; }
        .nav__link:hover, .nav__link.active { color: #fbbf24; background: rgba(251, 191, 36, 0.1); }
        .nav__buttons { display: flex; gap: 1rem; }
        .nav__toggle { display: none; font-size: 1.5rem; cursor: pointer; }
        
        /* Buttons */
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; }
        .btn--primary { background: linear-gradient(45deg, #f59e0b, #fbbf24); color: #0f172a; }
        .btn--primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3); }
        .btn--outline { background: transparent; border: 2px solid #fbbf24; color: #fbbf24; }
        .btn--outline:hover { background: rgba(251, 191, 36, 0.1); transform: translateY(-2px); }
        .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }
        .btn-lg { padding: 1rem 2rem; font-size: 1.125rem; }
        
        /* Main Content */
        .main { margin-top: 80px; }
        .section { padding: 4rem 2rem; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Hero Section */
        .hero { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        .hero__container { display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center; }
        .hero__badge { margin-bottom: 1rem; }
        .badge { background: rgba(251, 191, 36, 0.1); color: #fbbf24; padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.875rem; font-weight: 600; }
        .hero__title { font-size: 3.5rem; font-weight: 700; line-height: 1.2; margin-bottom: 1.5rem; }
        .gradient-text { background: linear-gradient(45deg, #f59e0b, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero__description { font-size: 1.25rem; color: #94a3b8; margin-bottom: 2rem; }
        .hero__buttons { display: flex; gap: 1rem; margin-bottom: 3rem; }
        .hero__stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
        .stat { text-align: center; }
        .stat__value { font-size: 2rem; font-weight: 700; color: #fbbf24; margin-bottom: 0.5rem; }
        .stat__label { color: #94a3b8; font-size: 0.875rem; }
        
        /* Floating Card */
        .floating-card { background: #1e293b; border-radius: 16px; padding: 2rem; box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3); border: 1px solid #334155; }
        .card__header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .card__header h3 { font-size: 1.25rem; font-weight: 600; }
        .live-indicator { display: flex; align-items: center; gap: 8px; font-size: 0.875rem; color: #10b981; }
        .dot { width: 8px; height: 8px; background: #10b981; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .card__content { display: flex; flex-direction: column; gap: 1rem; }
        .stat-item { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 0; border-bottom: 1px solid #334155; }
        .stat-item:last-child { border-bottom: none; }
        .stat-item .value { font-weight: 600; color: #fbbf24; }
        
        /* Section Headers */
        .section__header { text-align: center; margin-bottom: 3rem; }
        .section__title { font-size: 2.5rem; font-weight: 700; margin-bottom: 1rem; }
        .section__subtitle { font-size: 1.125rem; color: #94a3b8; max-width: 600px; margin: 0 auto; }
        
        /* Alerts */
        .alert { display: flex; align-items: center; gap: 12px; padding: 1rem 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .alert-warning { background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: #fbbf24; }
        
        /* Dashboard & Stats */
        .quick-stats, .referral-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card { background: #1e293b; border-radius: 12px; padding: 1.5rem; display: flex; align-items: center; gap: 1rem; border: 1px solid #334155; }
        .stat-icon { width: 50px; height: 50px; background: rgba(251, 191, 36, 0.1); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #fbbf24; font-size: 1.25rem; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: #fbbf24; }
        .stat-label { color: #94a3b8; font-size: 0.875rem; }
        
        /* Action Buttons */
        .action-buttons { display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        
        /* Tables */
        .investments-table { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background: #1e293b; border-radius: 12px; overflow: hidden; }
        th, td { padding: 1rem; text-align: left; border-bottom: 1px solid #334155; }
        th { background: rgba(251, 191, 36, 0.1); color: #fbbf24; font-weight: 600; }
        tr:last-child td { border-bottom: none; }
        
        /* Empty State */
        .empty-state { text-align: center; padding: 3rem; }
        .empty-icon { font-size: 4rem; color: #475569; margin-bottom: 1rem; }
        
        /* Investment Plans */
        .investment-plans { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-bottom: 3rem; }
        .plan-card { background: #1e293b; border-radius: 16px; padding: 2rem; border: 1px solid #334155; transition: all 0.3s; position: relative; cursor: pointer; }
        .plan-card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3); border-color: #fbbf24; }
        .plan-card.featured { border: 2px solid #fbbf24; transform: scale(1.05); }
        .plan-badge { position: absolute; top: -10px; right: 20px; background: #f59e0b; color: #0f172a; padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.75rem; font-weight: 700; }
        .plan-name { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; }
        .plan-roi { font-size: 1.75rem; font-weight: 700; color: #fbbf24; margin-bottom: 0.5rem; }
        .plan-range { color: #94a3b8; margin-bottom: 1rem; }
        .plan-duration, .plan-total { margin-bottom: 0.5rem; }
        .plan-features { list-style: none; margin: 1.5rem 0; }
        .plan-features li { display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem; }
        .plan-features li i { color: #10b981; }
        
        /* Investment Form */
        .investment-form-container { display: none; background: #1e293b; border-radius: 16px; padding: 2rem; border: 1px solid #334155; }
        .investment-form-container.active { display: block; }
        .form-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
        .form-input { width: 100%; padding: 0.75rem 1rem; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: #e2e8f0; font-size: 1rem; }
        .form-input:focus { outline: none; border-color: #fbbf24; }
        .amount-range { color: #94a3b8; font-size: 0.875rem; margin-top: 0.5rem; }
        .plan-summary { background: rgba(251, 191, 36, 0.1); padding: 1rem; border-radius: 8px; }
        .investment-summary { background: #0f172a; padding: 1.5rem; border-radius: 12px; margin: 2rem 0; }
        .investment-summary h3 { margin-bottom: 1rem; }
        .summary-item { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid #334155; }
        .summary-item.total { font-weight: 700; font-size: 1.125rem; border-bottom: none; color: #fbbf24; }
        
        /* Success State */
        .investment-success { display: none; text-align: center; padding: 3rem; }
        .investment-success.active { display: block; }
        .success-icon { font-size: 4rem; color: #10b981; margin-bottom: 1rem; }
        .success-actions { display: flex; gap: 1rem; justify-content: center; margin-top: 2rem; }
        
        /* Referral Section */
        .referral-link-container { margin-bottom: 3rem; }
        .link-display { display: flex; gap: 1rem; margin: 1.5rem 0; }
        .link-input { flex: 1; padding: 0.75rem 1rem; background: #0f172a; border: 1px solid #334155; border-radius: 8px; color: #e2e8f0; }
        .social-share { display: flex; gap: 1rem; justify-content: center; }
        .social-btn { width: 50px; height: 50px; border-radius: 50%; background: #1e293b; border: 1px solid #334155; color: #e2e8f0; font-size: 1.25rem; cursor: pointer; transition: all 0.3s; }
        .social-btn:hover { background: #334155; transform: translateY(-2px); }
        
        /* Levels Grid */
        .levels-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
        .level-card { background: #1e293b; border-radius: 12px; padding: 1.5rem; border: 1px solid #334155; }
        .level-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; }
        .level-number { width: 40px; height: 40px; background: linear-gradient(45deg, #f59e0b, #fbbf24); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: #0f172a; }
        .level-commission { font-weight: 600; color: #fbbf24; }
        .level-requirements { margin-bottom: 1rem; }
        .requirement { display: flex; align-items: center; gap: 8px; margin-bottom: 0.5rem; font-size: 0.875rem; }
        .requirement i { color: #10b981; }
        .level-stats .stat { display: flex; justify-content: space-between; font-size: 0.875rem; }
        
        /* Bonus Claim */
        .bonus-claim-section { margin-bottom: 3rem; }
        .claim-card { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border-radius: 16px; padding: 2rem; display: flex; justify-content: space-between; align-items: center; border: 1px solid #fbbf24; }
        .bonus-amount { font-size: 2rem; font-weight: 700; color: #fbbf24; margin-top: 0.5rem; }
        
        /* Steps Grid */
        .steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; }
        .step-card { text-align: center; padding: 2rem 1rem; }
        .step-number { width: 60px; height: 60px; background: rgba(251, 191, 36, 0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 700; color: #fbbf24; margin: 0 auto 1rem; }
        
        /* Footer */
        .footer { background: #0a0f1c; padding: 4rem 0 2rem; border-top: 1px solid #1e293b; }
        .footer__content { display: grid; grid-template-columns: 1fr 2fr; gap: 4rem; margin-bottom: 3rem; }
        .footer__logo { display: flex; align-items: center; gap: 12px; margin-bottom: 1rem; }
        .footer__logo img { width: 40px; height: 40px; }
        .footer__logo span { font-size: 1.25rem; font-weight: 700; color: #fbbf24; }
        .footer__description { color: #94a3b8; margin-bottom: 1.5rem; max-width: 300px; }
        .footer__social { display: flex; gap: 1rem; }
        .social__link { width: 40px; height: 40px; background: #1e293b; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #e2e8f0; transition: all 0.3s; }
        .social__link:hover { background: #fbbf24; color: #0f172a; transform: translateY(-2px); }
        .footer__links { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; }
        .footer__column h4 { color: #fbbf24; margin-bottom: 1rem; font-size: 1.125rem; }
        .footer__column a { display: block; color: #94a3b8; text-decoration: none; margin-bottom: 0.5rem; transition: color 0.3s; }
        .footer__column a:hover { color: #fbbf24; }
        .footer__bottom { text-align: center; padding-top: 2rem; border-top: 1px solid #1e293b; color: #64748b; }
        
        /* Notification */
        .notification { position: fixed; top: 100px; right: 20px; padding: 1rem 1.5rem; border-radius: 8px; background: #1e293b; border: 1px solid #334155; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); transform: translateX(400px); transition: transform 0.3s; z-index: 1001; }
        .notification.show { transform: translateX(0); }
        .notification.success { border-left: 4px solid #10b981; }
        .notification.error { border-left: 4px solid #ef4444; }
        .notification.info { border-left: 4px solid #3b82f6; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .nav__menu { position: fixed; top: 80px; left: -100%; width: 80%; height: calc(100vh - 80px); background: #0f172a; flex-direction: column; padding: 2rem; transition: left 0.3s; }
            .nav__menu.active { left: 0; }
            .nav__list { flex-direction: column; }
            .nav__toggle { display: block; }
            .hero__container { grid-template-columns: 1fr; }
            .hero__title { font-size: 2.5rem; }
            .footer__content { grid-template-columns: 1fr; }
            .footer__links { grid-template-columns: 1fr; }
            .link-display { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- Preloader -->
    <div class="preloader">
        <div class="loader">
            <div class="gold-bar"></div>
            <div class="gold-bar"></div>
            <div class="gold-bar"></div>
        </div>
    </div>

    <!-- Header & Navigation -->
    <header class="header">
        <nav class="nav container">
            <div class="nav__logo">
                <img src="https://files.catbox.moe/3o41t1.png" alt="Aurion Finance" class="logo">
                <div class="logo__text">AURION FINANCE</div>
            </div>
            <div class="nav__menu" id="nav-menu">
                <ul class="nav__list">
                    <li class="nav__item"><a class="nav__link active" data-section="home">Home</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="dashboard">Dashboard</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="invest">Invest</a></li>
                    <li class="nav__item"><a class="nav__link" data-section="referral">Referral</a></li>
                </ul>
                <div class="nav__buttons">
                    <button class="btn btn--outline" id="connectWallet">
                        <i class="fas fa-wallet"></i> Connect Wallet
                    </button>
                </div>
            </div>
            <div class="nav__toggle" id="nav-toggle"><i class="fas fa-bars"></i></div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main">
        <!-- Home Section -->
        <section class="hero section" id="home">
            <div class="hero__container container">
                <div class="hero__content">
                    <div class="hero__badge"><span class="badge">PROFESSIONAL INVESTMENT PLATFORM</span></div>
                    <h1 class="hero__title">Secure <span class="gradient-text">USDT Investments</span> with Daily Returns</h1>
                    <p class="hero__description">Aurion Finance offers professional investment opportunities with guaranteed daily ROI, multi-level referral system, and secure smart contract technology.</p>
                    <div class="hero__buttons">
                        <button class="btn btn--primary" data-section="invest"><i class="fas fa-rocket"></i> Start Investing</button>
                        <button class="btn btn--outline" data-section="dashboard"><i class="fas fa-chart-line"></i> View Dashboard</button>
                    </div>
                    <div class="hero__stats">
                        <div class="stat"><div class="stat__value" id="totalTVL">$0</div><div class="stat__label">Total Value Locked</div></div>
                        <div class="stat"><div class="stat__value" id="totalUsers">0</div><div class="stat__label">Active Investors</div></div>
                        <div class="stat"><div class="stat__value" id="totalPaid">$0</div><div class="stat__label">Total Paid Out</div></div>
                    </div>
                </div>
                <div class="hero__image">
                    <div class="floating-card">
                        <div class="card__header">
                            <h3>Live Contract Stats</h3>
                            <div class="live-indicator"><span class="dot"></span> LIVE</div>
                        </div>
                        <div class="card__content">
                            <div class="stat-item"><span>Contract Balance</span><span class="value" id="contractBalance">0 USDT</span></div>
                            <div class="stat-item"><span>Daily ROI Rate</span><span class="value">1% - 2%</span></div>
                            <div class="stat-item"><span>Investment Plans</span><span class="value">5 Tiers</span></div>
                            <div class="stat-item"><span>Referral Levels</span><span class="value">4 Levels</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section class="dashboard-section section" id="dashboard" style="display: none;">
            <div class="container">
                <div class="section__header">
                    <h2 class="section__title">Your Dashboard</h2>
                    <p class="section__subtitle">Monitor your investments and earnings in real-time</p>
                </div>
                <div class="alert alert-warning" id="dashboardWalletAlert"><i class="fas fa-exclamation-triangle"></i><span>Please connect your wallet to view your dashboard</span></div>
                <div class="quick-stats" id="quickStats" style="display: none;">
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-wallet"></i></div><div class="stat-info"><div class="stat-value" id="totalDeposits">0 USDT</div><div class="stat-label">Total Deposits</div></div></div>
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-chart-line"></i></div><div class="stat-info"><div class="stat-value" id="availableEarnings">0 USDT</div><div class="stat-label">Available Earnings</div></div></div>
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-gift"></i></div><div class="stat-info"><div class="stat-value" id="referralBonus">0 USDT</div><div class="stat-label">Referral Bonus</div></div></div>
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-users"></i></div><div class="stat-info"><div class="stat-value" id="directReferrals">0</div><div class="stat-label">Direct Referrals</div></div></div>
                </div>
                <div class="action-buttons" id="actionButtons" style="display: none;">
                    <button class="btn btn--primary" data-section="invest"><i class="fas fa-plus"></i> New Investment</button>
                    <button class="btn btn--outline" id="withdrawEarnings"><i class="fas fa-download"></i> Withdraw Earnings</button>
                    <button class="btn btn--outline" data-section="referral"><i class="fas fa-share"></i> Referral Program</button>
                </div>
                <div class="investments-table" id="investmentsSection" style="display: none;">
                    <table><thead><tr><th>Plan</th><th>Amount</th><th>Start Date</th><th>Daily ROI</th><th>Total Withdrawn</th><th>Status</th></tr></thead><tbody id="investmentsTableBody"></tbody></table>
                </div>
                <div class="empty-state" id="noInvestmentsMessage" style="display: none;">
                    <div class="empty-icon"><i class="fas fa-chart-pie"></i></div><h3>No Active Investments</h3><p>Start your first investment to begin earning daily returns</p>
                    <button class="btn btn--primary" data-section="invest"><i class="fas fa-rocket"></i> Start Investing</button>
                </div>
            </div>
        </section>

        <!-- Invest Section -->
        <section class="invest-section section" id="invest" style="display: none;">
            <div class="container">
                <div class="section__header">
                    <h2 class="section__title">Start Investing</h2>
                    <p class="section__subtitle">Choose your investment plan and start earning daily returns</p>
                </div>
                <div class="alert alert-warning" id="investWalletAlert"><i class="fas fa-exclamation-triangle"></i><span>Please connect your wallet to start investing</span></div>
                <div class="investment-plans" id="investmentPlans"></div>
                <div class="investment-form-container" id="investmentForm">
                    <div class="form-header">
                        <h2>Complete Your Investment</h2>
                        <button class="btn btn--outline btn-sm" id="backToPlans"><i class="fas fa-arrow-left"></i> Back to Plans</button>
                    </div>
                    <div class="investment-form">
                        <div class="form-group">
                            <label for="selectedPlan">Selected Plan</label>
                            <div class="plan-summary" id="selectedPlanSummary"></div>
                        </div>
                        <div class="form-group">
                            <label for="investmentAmount">Investment Amount (USDT)</label>
                            <input type="number" id="investmentAmount" class="form-input" placeholder="Enter amount in USDT" min="20" step="1">
                            <div class="amount-range" id="amountRange"></div>
                        </div>
                        <div class="form-group">
                            <label for="referrerAddress">Referrer Address (Optional)</label>
                            <input type="text" id="referrerAddress" class="form-input" placeholder="Enter referrer wallet address">
                            <small>If you were referred by someone, enter their wallet address here</small>
                        </div>
                        <div class="investment-summary">
                            <h3>Investment Summary</h3>
                            <div class="summary-item"><span>Investment Amount:</span><span id="summaryAmount">0 USDT</span></div>
                            <div class="summary-item"><span>Platform Fee (10%):</span><span id="summaryFee">0 USDT</span></div>
                            <div class="summary-item total"><span>Total to Pay:</span><span id="summaryTotal">0 USDT</span></div>
                        </div>
                        <button class="btn btn--primary btn-lg" id="confirmInvestment"><i class="fas fa-check-circle"></i> Confirm Investment</button>
                    </div>
                </div>
                <div class="investment-success" id="investmentSuccess">
                    <div class="success-icon"><i class="fas fa-check-circle"></i></div>
                    <h2>Investment Successful!</h2>
                    <p>Your investment has been processed successfully. You can now monitor your earnings in the dashboard.</p>
                    <div class="success-actions">
                        <button class="btn btn--primary" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Go to Dashboard</button>
                        <button class="btn btn--outline" id="newInvestment"><i class="fas fa-plus"></i> New Investment</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Referral Section -->
        <section class="referral-section section" id="referral" style="display: none;">
            <div class="container">
                <div class="section__header">
                    <h2 class="section__title">Referral Program</h2>
                    <p class="section__subtitle">Earn commissions from 4 levels of your referral network</p>
                </div>
                <div class="alert alert-warning" id="referralWalletAlert"><i class="fas fa-exclamation-triangle"></i><span>Please connect your wallet to access referral program</span></div>
                <div class="referral-stats" id="referralStats" style="display: none;">
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-users"></i></div><div class="stat-info"><div class="stat-value" id="totalTeam">0</div><div class="stat-label">Total Team</div></div></div>
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-user-plus"></i></div><div class="stat-info"><div class="stat-value" id="referralDirectReferrals">0</div><div class="stat-label">Direct Referrals</div></div></div>
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-gift"></i></div><div class="stat-info"><div class="stat-value" id="totalBonus">0 USDT</div><div class="stat-label">Total Bonus Earned</div></div></div>
                    <div class="stat-card"><div class="stat-icon"><i class="fas fa-wallet"></i></div><div class="stat-info"><div class="stat-value" id="availableBonus">0 USDT</div><div class="stat-label">Available Bonus</div></div></div>
                </div>
                <div class="referral-link-container" id="referralLinkSection" style="display: none;">
                    <div class="section-header"><h2>Your Referral Link</h2><p>Share this link with your friends and earn commissions from their investments</p></div>
                    <div class="link-display">
                        <input type="text" id="referralLink" class="link-input" readonly>
                        <button class="btn btn--primary" id="copyLink"><i class="fas fa-copy"></i> Copy</button>
                    </div>
                    <div class="social-share">
                        <button class="social-btn" id="shareTelegram"><i class="fab fa-telegram"></i></button>
                        <button class="social-btn" id="shareTwitter"><i class="fab fa-twitter"></i></button>
                        <button class="social-btn" id="shareWhatsapp"><i class="fab fa-whatsapp"></i></button>
                    </div>
                </div>
                <div class="levels-grid">
                    <div class="level-card"><div class="level-header"><div class="level-number">1</div><div class="level-commission">5% Commission</div></div><div class="level-requirements"><div class="requirement"><i class="fas fa-check"></i><span>No minimum referrals required</span></div><div class="requirement"><i class="fas fa-check"></i><span>Active investment required</span></div></div><div class="level-stats"><div class="stat"><span>Your Referrals:</span><span id="level1Count">0</span></div></div></div>
                    <div class="level-card"><div class="level-header"><div class="level-number">2</div><div class="level-commission">3% Commission</div></div><div class="level-requirements"><div class="requirement"><i class="fas fa-check"></i><span>10+ direct referrals</span></div><div class="requirement"><i class="fas fa-check"></i><span>Active investment required</span></div></div><div class="level-stats"><div class="stat"><span>Your Referrals:</span><span id="level2Count">0</span></div></div></div>
                    <div class="level-card"><div class="level-header"><div class="level-number">3</div><div class="level-commission">1% Commission</div></div><div class="level-requirements"><div class="requirement"><i class="fas fa-check"></i><span>15+ direct referrals</span></div><div class="requirement"><i class="fas fa-check"></i><span>Active investment required</span></div></div><div class="level-stats"><div class="stat"><span>Your Referrals:</span><span id="level3Count">0</span></div></div></div>
                    <div class="level-card"><div class="level-header"><div class="level-number">4</div><div class="level-commission">1% Commission</div></div><div class="level-requirements"><div class="requirement"><i class="fas fa-check"></i><span>20+ direct referrals</span></div><div class="requirement"><i class="fas fa-check"></i><span>Active investment required</span></div></div><div class="level-stats"><div class="stat"><span>Your Referrals:</span><span id="level4Count">0</span></div></div></div>
                </div>
                <div class="bonus-claim-section" id="bonusClaimSection" style="display: none;">
                    <div class="claim-card">
                        <div class="claim-info"><h3>Available Referral Bonus</h3><p>You have unclaimed referral commissions ready for withdrawal</p><div class="bonus-amount" id="claimableBonus">0 USDT</div></div>
                        <button class="btn btn--primary" id="claimBonus"><i class="fas fa-gift"></i> Claim Bonus</button>
                    </div>
                </div>
                <div class="steps-grid">
                    <div class="step-card"><div class="step-number">1</div><h3>Share Your Link</h3><p>Share your unique referral link with friends and community members</p></div>
                    <div class="step-card"><div class="step-number">2</div><h3>They Invest</h3><p>When someone invests using your link, they become part of your team</p></div>
                    <div class="step-card"><div class="step-number">3</div><h3>Earn Commissions</h3><p>Earn commissions from their investments across 4 different levels</p></div>
                    <div class="step-card"><div class="step-number">4</div><h3>Claim Rewards</h3><p>Withdraw your referral bonuses anytime to your wallet</p></div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer__content">
                <div class="footer__brand">
                    <div class="footer__logo"><img src="https://files.catbox.moe/3o41t1.png" alt="Aurion Finance"><span>AURION FINANCE</span></div>
                    <p class="footer__description">Professional USDT investment platform with secure smart contract technology and guaranteed returns.</p>
                    <div class="footer__social">
                        <a href="#" class="social__link"><i class="fab fa-telegram"></i></a>
                        <a href="#" class="social__link"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="social__link"><i class="fab fa-github"></i></a>
                    </div>
                </div>
                <div class="footer__links">
                    <div class="footer__column"><h4>Platform</h4><a class="footer-link" data-section="home">Home</a><a class="footer-link" data-section="invest">Invest</a><a class="footer-link" data-section="referral">Referral</a><a class="footer-link" data-section="dashboard">Dashboard</a></div>
                    <div class="footer__column"><h4>Resources</h4><a href="#">Whitepaper</a><a href="#">Audit Report</a><a href="#">Documentation</a><a href="#">FAQ</a></div>
                    <div class="footer__column"><h4>Legal</h4><a href="#">Terms of Service</a><a href="#">Privacy Policy</a><a href="#">Risk Disclosure</a></div>
                </div>
            </div>
            <div class="footer__bottom"><p>&copy; 2024 Aurion Finance. All rights reserved.</p></div>
        </div>
    </footer>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script>
        // Contract Configuration
        const CONTRACT_ADDRESS = '0xaDb78631123CD4B4686365423B80C344E438b7d6';
        const USDT_ADDRESS = '0x55d398326f99059fF775485246999027B3197955';
        
        // USDT ABI (Simplified)
        const USDT_ABI = [
            {
                "constant": false,
                "inputs": [{"name": "_spender", "type": "address"}, {"name": "_value", "type": "uint256"}],
                "name": "approve",
                "outputs": [{"name": "", "type": "bool"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [{"name": "_owner", "type": "address"}],
                "name": "balanceOf",
                "outputs": [{"name": "balance", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [{"name": "_owner", "type": "address"}, {"name": "_spender", "type": "address"}],
                "name": "allowance",
                "outputs": [{"name": "", "type": "uint256"}],
                "type": "function"
            },
            {
                "constant": true,
                "inputs": [],
                "name": "decimals",
                "outputs": [{"name": "", "type": "uint8"}],
                "type": "function"
            }
        ];

        // Main Contract ABI (Fixed untuk menghindari error)
        const CONTRACT_ABI = [
            {
                "inputs": [{"internalType": "uint256", "name": "_amount", "type": "uint256"}, {"internalType": "uint256", "name": "_planId", "type": "uint256"}, {"internalType": "address", "name": "_upline", "type": "address"}],
                "name": "deposit",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "withdraw",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "_user", "type": "address"}],
                "name": "getUserInfo",
                "outputs": [
                    {"internalType": "uint256", "name": "totalDeposits", "type": "uint256"},
                    {"internalType": "uint256", "name": "totalWithdrawn", "type": "uint256"},
                    {"internalType": "uint256", "name": "directReferrals", "type": "uint256"},
                    {"internalType": "uint256", "name": "referralBonus", "type": "uint256"},
                    {"internalType": "uint256", "name": "availableEarnings", "type": "uint256"},
                    {"internalType": "address", "name": "upline", "type": "address"},
                    {"internalType": "bool", "name": "hasActiveInvestment", "type": "bool"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getContractBalance",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "_user", "type": "address"}],
                "name": "calculateAvailableEarnings",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "MIN_DEPOSIT",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        // Global Variables
        let web3;
        let contract;
        let usdtContract;
        let userAccount;
        let selectedPlan = null;
        let usdtDecimals = 6;

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            generateInvestmentPlans();
            checkPreloader();
        });

        // Initialize Web3 and Contract
        async function initializeApp() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    web3 = new Web3(window.ethereum);
                    contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                    usdtContract = new web3.eth.Contract(USDT_ABI, USDT_ADDRESS);
                    
                    console.log('Web3 initialized successfully');
                    
                    // Get USDT decimals
                    try {
                        const decimals = await usdtContract.methods.decimals().call();
                        usdtDecimals = parseInt(decimals);
                        console.log('USDT Decimals:', usdtDecimals);
                    } catch (error) {
                        console.log('Using default USDT decimals: 6');
                        usdtDecimals = 6;
                    }
                    
                    const accounts = await web3.eth.getAccounts();
                    if (accounts.length > 0) {
                        userAccount = accounts[0];
                        updateWalletUI();
                        await loadContractData();
                    }
                } catch (error) {
                    console.error('Error initializing Web3:', error);
                    showNotification('Error connecting to blockchain', 'error');
                }
            } else {
                showNotification('Please install MetaMask to use this dApp', 'error');
            }
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Navigation
            document.getElementById('nav-toggle').addEventListener('click', () => {
                document.getElementById('nav-menu').classList.toggle('active');
            });
            
            // Navigation links
            document.querySelectorAll('.nav__link, .footer-link, [data-section]').forEach(element => {
                if (!element.classList.contains('nav__link') || element.classList.contains('nav__link')) {
                    element.addEventListener('click', (e) => {
                        e.preventDefault();
                        const section = e.target.getAttribute('data-section');
                        showSection(section);
                        document.getElementById('nav-menu').classList.remove('active');
                    });
                }
            });

            // Wallet connection
            document.getElementById('connectWallet').addEventListener('click', connectWallet);

            // Investment related
            document.getElementById('backToPlans').addEventListener('click', showPlans);
            document.getElementById('confirmInvestment').addEventListener('click', confirmInvestment);
            document.getElementById('newInvestment').addEventListener('click', showPlans);
            document.getElementById('investmentAmount').addEventListener('input', updateInvestmentSummary);

            // Withdraw earnings
            document.getElementById('withdrawEarnings').addEventListener('click', withdrawEarnings);

            // Referral related
            document.getElementById('copyLink').addEventListener('click', copyReferralLink);
            document.getElementById('claimBonus').addEventListener('click', claimReferralBonus);

            // Wallet account changes
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', (accounts) => {
                    userAccount = accounts.length > 0 ? accounts[0] : null;
                    updateWalletUI();
                    if (userAccount) loadContractData();
                });
            }
        }

        // Navigation Functions
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            document.querySelectorAll('.nav__link').forEach(link => {
                link.classList.remove('active');
            });
            
            if (document.getElementById(sectionName)) {
                document.getElementById(sectionName).style.display = 'block';
                document.querySelector(`.nav__link[data-section="${sectionName}"]`).classList.add('active');
                
                if (sectionName === 'dashboard' || sectionName === 'referral') {
                    loadUserData();
                }
            }
        }

        // Wallet Functions
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                showNotification('Please install MetaMask!', 'error');
                return;
            }

            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                userAccount = accounts[0];
                updateWalletUI();
                await loadContractData();
                showNotification('Wallet connected successfully!', 'success');
            } catch (error) {
                console.error('Error connecting wallet:', error);
                showNotification('Failed to connect wallet', 'error');
            }
        }

        function updateWalletUI() {
            const connectBtn = document.getElementById('connectWallet');
            if (userAccount) {
                connectBtn.innerHTML = `<i class="fas fa-wallet"></i> ${userAccount.substring(0, 6)}...${userAccount.substring(38)}`;
                document.querySelectorAll('.alert-warning').forEach(alert => alert.style.display = 'none');
                document.getElementById('quickStats').style.display = 'grid';
                document.getElementById('actionButtons').style.display = 'flex';
                document.getElementById('referralStats').style.display = 'grid';
                document.getElementById('referralLinkSection').style.display = 'block';
                document.getElementById('bonusClaimSection').style.display = 'block';
            } else {
                connectBtn.innerHTML = '<i class="fas fa-wallet"></i> Connect Wallet';
                document.querySelectorAll('.alert-warning').forEach(alert => alert.style.display = 'flex');
                document.getElementById('quickStats').style.display = 'none';
                document.getElementById('actionButtons').style.display = 'none';
                document.getElementById('referralStats').style.display = 'none';
                document.getElementById('referralLinkSection').style.display = 'none';
                document.getElementById('bonusClaimSection').style.display = 'none';
            }
        }

        // Contract Data Functions
        async function loadContractData() {
            if (!contract || !userAccount) return;

            try {
                const contractBalance = await contract.methods.getContractBalance().call();
                document.getElementById('contractBalance').textContent = `${formatUSDT(contractBalance)} USDT`;
                document.getElementById('totalTVL').textContent = `$${formatUSDT(contractBalance)}`;
                
                await loadUserData();
            } catch (error) {
                console.error('Error loading contract data:', error);
            }
        }

        async function loadUserData() {
            if (!contract || !userAccount) return;

            try {
                const userInfo = await contract.methods.getUserInfo(userAccount).call();
                const availableEarnings = await contract.methods.calculateAvailableEarnings(userAccount).call();

                // Update dashboard
                document.getElementById('totalDeposits').textContent = `${formatUSDT(userInfo.totalDeposits)} USDT`;
                document.getElementById('availableEarnings').textContent = `${formatUSDT(availableEarnings)} USDT`;
                document.getElementById('referralBonus').textContent = `${formatUSDT(userInfo.referralBonus)} USDT`;
                document.getElementById('directReferrals').textContent = userInfo.directReferrals;

                // Update referral section
                document.getElementById('totalTeam').textContent = userInfo.directReferrals;
                document.getElementById('referralDirectReferrals').textContent = userInfo.directReferrals;
                document.getElementById('totalBonus').textContent = `${formatUSDT(userInfo.referralBonus)} USDT`;
                document.getElementById('availableBonus').textContent = `${formatUSDT(userInfo.referralBonus)} USDT`;
                document.getElementById('claimableBonus').textContent = `${formatUSDT(userInfo.referralBonus)} USDT`;

                // Show/hide investments table
                if (userInfo.hasActiveInvestment) {
                    document.getElementById('investmentsSection').style.display = 'block';
                    document.getElementById('noInvestmentsMessage').style.display = 'none';
                } else {
                    document.getElementById('investmentsSection').style.display = 'none';
                    document.getElementById('noInvestmentsMessage').style.display = 'block';
                }

                // Generate referral link
                generateReferralLink();

            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        function generateReferralLink() {
            const referralLink = document.getElementById('referralLink');
            if (referralLink && userAccount) {
                const baseUrl = window.location.origin + window.location.pathname;
                referralLink.value = `${baseUrl}?ref=${userAccount}`;
            }
        }

        // Investment Functions
        function generateInvestmentPlans() {
            const plans = [
                { id: 0, name: 'Starter Plan', roi: '1% Daily', minAmount: 20, maxAmount: 499, duration: '150 Days', total: '150% Total ROI', features: ['1% Daily ROI', '150 Days Duration', '150% Total Returns', '4-Level Referral'], featured: false },
                { id: 1, name: 'Advanced Plan', roi: '1.2% Daily', minAmount: 500, maxAmount: 1999, duration: '150 Days', total: '180% Total ROI', features: ['1.2% Daily ROI', '150 Days Duration', '180% Total Returns', '4-Level Referral'], featured: false },
                { id: 2, name: 'Professional Plan', roi: '1.5% Daily', minAmount: 2000, maxAmount: 4999, duration: '150 Days', total: '225% Total ROI', features: ['1.5% Daily ROI', '150 Days Duration', '225% Total Returns', '4-Level Referral'], featured: true },
                { id: 3, name: 'Premium Plan', roi: '1.8% Daily', minAmount: 5000, maxAmount: 9999, duration: '150 Days', total: '270% Total ROI', features: ['1.8% Daily ROI', '150 Days Duration', '270% Total Returns', '4-Level Referral'], featured: false },
                { id: 4, name: 'VIP Plan', roi: '2% Daily', minAmount: 10000, maxAmount: 999999, duration: '150 Days', total: '300% Total ROI', features: ['2% Daily ROI', '150 Days Duration', '300% Total Returns', '4-Level Referral'], featured: false }
            ];

            const container = document.getElementById('investmentPlans');
            container.innerHTML = plans.map(plan => `
                <div class="plan-card ${plan.featured ? 'featured' : ''}" onclick="selectPlan(${plan.id})">
                    ${plan.featured ? '<div class="plan-badge">Popular</div>' : ''}
                    <div class="plan-name">${plan.name}</div>
                    <div class="plan-roi">${plan.roi}</div>
                    <div class="plan-range">${plan.minAmount} - ${plan.maxAmount === 999999 ? 'Unlimited' : plan.maxAmount} USDT</div>
                    <div class="plan-duration">${plan.duration}</div>
                    <div class="plan-total">${plan.total}</div>
                    <ul class="plan-features">${plan.features.map(f => `<li><i class="fas fa-check"></i> ${f}</li>`).join('')}</ul>
                    <button class="btn btn--primary"><i class="fas fa-arrow-right"></i> Select Plan</button>
                </div>
            `).join('');
        }

        function selectPlan(planId) {
            if (!userAccount) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            const plans = [
                { id: 0, name: 'Starter Plan', roi: '1% Daily', minAmount: 20, maxAmount: 499 },
                { id: 1, name: 'Advanced Plan', roi: '1.2% Daily', minAmount: 500, maxAmount: 1999 },
                { id: 2, name: 'Professional Plan', roi: '1.5% Daily', minAmount: 2000, maxAmount: 4999 },
                { id: 3, name: 'Premium Plan', roi: '1.8% Daily', minAmount: 5000, maxAmount: 9999 },
                { id: 4, name: 'VIP Plan', roi: '2% Daily', minAmount: 10000, maxAmount: 999999 }
            ];

            selectedPlan = plans.find(plan => plan.id === planId);
            if (selectedPlan) {
                showInvestmentForm();
                updatePlanSummary();
                updateAmountRange();
                updateInvestmentSummary();
            }
        }

        function showInvestmentForm() {
            document.getElementById('investmentPlans').style.display = 'none';
            document.getElementById('investmentForm').classList.add('active');
        }

        function showPlans() {
            document.getElementById('investmentPlans').style.display = 'grid';
            document.getElementById('investmentForm').classList.remove('active');
            document.getElementById('investmentSuccess').classList.remove('active');
            selectedPlan = null;
        }

        function showSuccess() {
            document.getElementById('investmentForm').classList.remove('active');
            document.getElementById('investmentSuccess').classList.add('active');
        }

        function updatePlanSummary() {
            const summary = document.getElementById('selectedPlanSummary');
            if (selectedPlan) {
                summary.innerHTML = `
                    <div class="plan-name">${selectedPlan.name}</div>
                    <div class="plan-roi">${selectedPlan.roi}</div>
                    <div class="plan-range">${selectedPlan.minAmount} - ${selectedPlan.maxAmount === 999999 ? 'Unlimited' : selectedPlan.maxAmount} USDT</div>
                `;
            }
        }

        function updateAmountRange() {
            const range = document.getElementById('amountRange');
            const input = document.getElementById('investmentAmount');
            if (selectedPlan) {
                range.textContent = `Minimum: ${selectedPlan.minAmount} USDT, Maximum: ${selectedPlan.maxAmount === 999999 ? 'Unlimited' : selectedPlan.maxAmount} USDT`;
                input.min = selectedPlan.minAmount;
                input.max = selectedPlan.maxAmount === 999999 ? '' : selectedPlan.maxAmount;
                input.value = selectedPlan.minAmount;
            }
        }

        function updateInvestmentSummary() {
            const amount = parseFloat(document.getElementById('investmentAmount').value) || 0;
            const fee = amount * 0.10;
            
            document.getElementById('summaryAmount').textContent = `${amount.toFixed(2)} USDT`;
            document.getElementById('summaryFee').textContent = `${fee.toFixed(2)} USDT`;
            document.getElementById('summaryTotal').textContent = `${amount.toFixed(2)} USDT`;
        }

        // FIXED INVESTMENT FUNCTION - SOLUSI UTAMA
        async function confirmInvestment() {
            if (!contract || !userAccount) {
                showNotification('Please connect your wallet first', 'error');
                return;
            }

            if (!selectedPlan) {
                showNotification('Please select an investment plan', 'error');
                return;
            }

            const amountInput = document.getElementById('investmentAmount');
            const amount = parseFloat(amountInput.value) || 0;

            // Validation
            if (amount < selectedPlan.minAmount) {
                showNotification(`Minimum investment is ${selectedPlan.minAmount} USDT`, 'error');
                return;
            }

            if (selectedPlan.maxAmount !== 999999 && amount > selectedPlan.maxAmount) {
                showNotification(`Maximum investment is ${selectedPlan.maxAmount} USDT`, 'error');
                return;
            }

            try {
                const confirmBtn = document.getElementById('confirmInvestment');
                confirmBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                confirmBtn.disabled = true;

                // Convert amount to wei (USDT uses 6 decimals)
                const amountWei = web3.utils.toWei(amount.toString(), 'mwei');
                const amountWithBuffer = web3.utils.toWei((amount * 1.1).toString(), 'mwei'); // Buffer untuk fee

                // Check USDT balance
                const balance = await usdtContract.methods.balanceOf(userAccount).call();
                const balanceFormatted = parseFloat(web3.utils.fromWei(balance, 'mwei'));
                
                if (balanceFormatted < amount) {
                    showNotification(`Insufficient USDT balance. You have ${balanceFormatted.toFixed(2)} USDT`, 'error');
                    confirmBtn.innerHTML = '<i class="fas fa-check-circle"></i> Confirm Investment';
                    confirmBtn.disabled = false;
                    return;
                }

                // Check allowance dengan buffer
                const allowance = await usdtContract.methods.allowance(userAccount, CONTRACT_ADDRESS).call();
                const allowanceFormatted = parseFloat(web3.utils.fromWei(allowance, 'mwei'));
                
                if (allowanceFormatted < amount) {
                    showNotification('Approving USDT...', 'info');
                    try {
                        const approveResult = await usdtContract.methods.approve(CONTRACT_ADDRESS, amountWithBuffer).send({
                            from: userAccount,
                            gas: 100000
                        });
                        console.log('Approve result:', approveResult);
                        showNotification('USDT approved successfully', 'success');
                        await new Promise(resolve => setTimeout(resolve, 3000)); // Tunggu 3 detik
                    } catch (approveError) {
                        console.error('Approve error:', approveError);
                        showNotification('USDT approval failed', 'error');
                        throw approveError;
                    }
                }

                // Prepare parameters untuk deposit
                const referrerAddress = document.getElementById('referrerAddress').value;
                let finalReferrer = '0x0000000000000000000000000000000000000000';
                
                if (referrerAddress && web3.utils.isAddress(referrerAddress)) {
                    finalReferrer = referrerAddress;
                }

                showNotification('Making investment...', 'info');

                // Execute deposit dengan parameter yang lebih aman
                console.log('Deposit Parameters:', {
                    amountWei: amountWei,
                    planId: selectedPlan.id,
                    referrer: finalReferrer,
                    user: userAccount
                });

                const depositResult = await contract.methods.deposit(
                    amountWei,        // amount dalam wei (6 decimals)
                    selectedPlan.id,  // planId
                    finalReferrer     // referrer address
                ).send({
                    from: userAccount,
                    gas: 400000,      // Gas limit lebih tinggi
                    gasPrice: web3.utils.toWei('10', 'gwei') // Gas price lebih tinggi
                });

                console.log('Deposit transaction:', depositResult);
                showNotification('Investment successful!', 'success');
                showSuccess();
                await loadUserData();

            } catch (error) {
                console.error('Investment error details:', error);
                
                let errorMsg = 'Investment failed';
                if (error.code === 4001) {
                    errorMsg = 'Transaction rejected by user';
                } else if (error.message?.includes('reverted')) {
                    // Coba extract reason dari error
                    const revertReason = extractRevertReason(error);
                    errorMsg = `Contract reverted: ${revertReason || 'Unknown reason'}`;
                } else if (error.message?.includes('insufficient allowance')) {
                    errorMsg = 'Insufficient USDT allowance. Please try again.';
                } else {
                    errorMsg = error.message || 'Unknown error occurred';
                }
                
                showNotification(errorMsg, 'error');
            } finally {
                const confirmBtn = document.getElementById('confirmInvestment');
                confirmBtn.innerHTML = '<i class="fas fa-check-circle"></i> Confirm Investment';
                confirmBtn.disabled = false;
            }
        }

        // Fungsi untuk extract revert reason dari error
        function extractRevertReason(error) {
            try {
                const errorString = JSON.stringify(error);
                const reasonMatch = errorString.match(/reason="([^"]*)"/);
                if (reasonMatch) return reasonMatch[1];
                
                const messageMatch = errorString.match(/message":"([^"]*)"/);
                if (messageMatch) return messageMatch[1];
                
                return null;
            } catch {
                return null;
            }
        }

        async function withdrawEarnings() {
            if (!userAccount) {
                showNotification('Please connect wallet first', 'error');
                return;
            }

            try {
                const btn = document.getElementById('withdrawEarnings');
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                btn.disabled = true;

                await contract.methods.withdraw().send({
                    from: userAccount,
                    gas: 250000
                });

                showNotification('Withdrawal successful!', 'success');
                await loadUserData();
            } catch (error) {
                console.error('Withdrawal error:', error);
                showNotification('Withdrawal failed: ' + (error.message || 'Unknown error'), 'error');
            } finally {
                const btn = document.getElementById('withdrawEarnings');
                btn.innerHTML = '<i class="fas fa-download"></i> Withdraw Earnings';
                btn.disabled = false;
            }
        }

        async function claimReferralBonus() {
            if (!userAccount) {
                showNotification('Please connect wallet first', 'error');
                return;
            }

            try {
                const btn = document.getElementById('claimBonus');
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                btn.disabled = true;

                await contract.methods.withdraw().send({
                    from: userAccount,
                    gas: 250000
                });

                showNotification('Bonus claimed!', 'success');
                await loadUserData();
            } catch (error) {
                console.error('Bonus claim error:', error);
                showNotification('Claim failed: ' + (error.message || 'Unknown error'), 'error');
            } finally {
                const btn = document.getElementById('claimBonus');
                btn.innerHTML = '<i class="fas fa-gift"></i> Claim Bonus';
                btn.disabled = false;
            }
        }

        // Utility Functions
        function formatUSDT(amount) {
            if (!amount || !web3) return '0.00';
            return parseFloat(web3.utils.fromWei(amount.toString(), 'mwei')).toFixed(2);
        }

        function copyReferralLink() {
            const link = document.getElementById('referralLink');
            link.select();
            navigator.clipboard.writeText(link.value);
            showNotification('Link copied!', 'success');
        }

        function showNotification(message, type = 'info') {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.className = `notification ${type} show`;
            setTimeout(() => notif.classList.remove('show'), 5000);
        }

        function checkPreloader() {
            window.addEventListener('load', () => {
                setTimeout(() => {
                    document.querySelector('.preloader').classList.add('fade-out');
                    setTimeout(() => document.querySelector('.preloader').remove(), 500);
                }, 1000);
            });
        }

        // Global functions
        window.selectPlan = selectPlan;
        window.showSection = showSection;
    </script>
</body>
</html>
